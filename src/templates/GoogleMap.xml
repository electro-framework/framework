<?xml version="1.0" encoding="UTF-8"?>
<c:template name="google-map">
  <p:param name="id" type="identifier"/>
  <p:param name="background-color" type="text" default="#FFF"/>
  <p:param name="latitude" type="number" default="0"/>
  <p:param name="longitude" type="number" default="0"/>
  <p:param name="zoom" type="number" default="1"/>
  <p:param name="text" type="text"/>
  <p:param name="autoshow" type="boolean" default="yes"/>
  <p:param name="show-marker" type="boolean" default="no"/>
  <p:param name="draggable-marker" type="boolean" default="no"/>
  <p:param name="draggable" type="boolean" default="true"/>

  <p:param name="sensor" type="boolean" default="false"/>
  <p:param name="language" type="identifier" default="en"/>
  <p:param name="region" type="text"/>

  <p:script name="gmap">
    var mapsOnPage=[];

    function loadMap(args) {
      var myLatlng = new google.maps.LatLng(args.latitude, args.longitude);
      var myOptions = {
        zoom: args.zoom,
        center: myLatlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        draggable: args.draggable,
        zoomControl: true,
        backgroundColor: args.backgroundColor
      }
    var map = window[args.id + 'Obj'] = new google.maps.Map(document.getElementById(args.id),myOptions);
      if (args.showMarker) {
        var marker = window[args.id + 'Marker'] = new google.maps.Marker({
          draggable: args.draggableMarker,
          map: map,
          position: myLatlng,
          title: args.text
        });
      }
    }
    function googleMapsInit(deferredInit) {
      var t=deferredInit !== true;
      for (var n = 0; n < mapsOnPage.length; ++n)
        if (mapsOnPage[n].autoshow == t)
          loadMap(mapsOnPage[n]);
      if (t && exists('mapReady'))
        mapReady();
    }
  </p:script>
  <p:script>
    mapsOnPage.push({
      id:'{@id}',
      autoshow: {@autoshow},
      backgroundColor: '{@background-color}',
      latitude: number('{@latitude}',0),
      longitude: number('{@longitude}',0),
      zoom: number('{@zoom}',1),
      text: '{@text}',
      showMarker: {@show-marker},
      draggableMarker: {@draggable-marker},
      draggable: {@draggable}
    });
    if (mapsOnPage.length == 1)
      listen('onLoad',function(){
        loadScript('http://maps.googleapis.com/maps/api/js?sensor={@sensor}&language={@language}&region={@region}&callback=googleMapsInit');
      });
  </p:script>
  <p:body>
    <div id="{@id}" style="height:100%"></div>
  </p:body>
</c:template>