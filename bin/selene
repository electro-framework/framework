#!/usr/bin/env php
<?php
use Robo\Config;
use Symfony\Component\Console\Output\ConsoleOutput;

$tmp = dirname (dirname (dirname (__DIR__)));
require "$tmp/autoload.php";

$application = new Selene\Application();
$application->setup (dirname (dirname ($tmp)));

class Runner extends \Robo\Runner
{
  public function execute ($input = null)
  {
    global $application;

    register_shutdown_function ([$this, 'shutdown']);
    set_error_handler ([$this, 'handleError']);
    Config::setOutput (new ConsoleOutput());
    $input = $this->prepareInput ($input ? $input : $_SERVER['argv']);

    $class = "$application->tasksClass";
    if (!class_exists ($class)) {
      $this->getOutput ()->writeln("<error>Class '$class' was not found</error>");
      exit(1);
    }
    // Create and run the robo cli application
    $this->createApplication ($class)->run ($input);
  }
}

(new Runner())->execute ();
